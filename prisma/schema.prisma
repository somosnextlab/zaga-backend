// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===========================================
// MODELOS DE SEGURIDAD
// ===========================================

model Usuario {
  user_id    String   @id @db.Uuid
  persona_id String?  @db.Uuid
  rol        String   @db.Text
  estado     String   @db.Text
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  
  // Relaciones
  persona    Persona? @relation(fields: [persona_id], references: [id], onDelete: SetNull)
  
  @@map("seguridad.usuarios")
}

// ===========================================
// MODELOS FINANCIEROS
// ===========================================

model Persona {
  id                String    @id @default(uuid()) @db.Uuid
  tipo_doc          String    @db.Text
  numero_doc        String    @db.Text
  nombre            String    @db.Text
  apellido          String    @db.Text
  email             String?   @db.Text
  telefono          String?   @db.Text
  fecha_nac         DateTime? @db.Date
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  updated_at        DateTime  @updatedAt @db.Timestamptz(6)
  
  // Relaciones
  usuarios          Usuario[]
  clientes          Cliente[]
  
  // Índices únicos
  @@unique([tipo_doc, numero_doc], name: "personas_tipo_doc_numero_doc_key")
  @@map("financiera.personas")
}

model Cliente {
  id         String   @id @default(uuid()) @db.Uuid
  persona_id String   @db.Uuid
  estado     String   @db.Text
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  
  // Relaciones
  persona    Persona  @relation(fields: [persona_id], references: [id], onDelete: Cascade)
  
  @@map("financiera.clientes")
}